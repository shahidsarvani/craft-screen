<!DOCTYPE html>
<html lang="en">
<head>
	<title>Craft Screen Development</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="./assets/css/main.css" />
	<script src="./assets/js/jquery-3.6.0.min.js"></script> 
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> 
	<script src="./assets/js/lazyload.js"></script> 
	<script>
		function getPenPath() {
		  const nextPenSlugs = [
			'3d9a3b8092ebcf9bc4a72672b81df1ac',
			'2cde50c59ea73c47aec5bd26343ce287',
			'd83110c5f71ea23ba5800b6b1a4a95c4',
		  ];
		
		  let slug = nextPenSlugs[ this.loadCount ];
		  if ( slug ) return `/desandro/debug/${slug}`;
		}
    </script>  
</head>
<body>  

<div class="logo" id="fetch_site_logo">
   <a href="#"><img src="./assets/images/logo.svg" /></a> 
</div>

<div id="fetch_categories_data"> Loading... </div> 
<script src="./assets/js/spotlight.bundle.js"></script>
<script>   
	operate_main_cateogories();
	
	function operate_main_cateogories(){
	
		jQuery(document).ready(function($){	  
			//$('.loading').show();	
			$("#fetch_site_logo").css("display", "flex");
			$("#fetch_site_logo").fadeIn("slow");
			$("#fetch_categories_data .main-menu").fadeIn("slow");
			
			var random_number1 = Math.floor(Math.random() * 100);  
			var xmlDoc = readXml("./xml/layout.xml?rm="+random_number1); 
			var configObj = xmlDoc.getElementsByTagName("config"); 
			
			var site_name = configObj[0].getAttribute('site_name');
			var site_url = configObj[0].getAttribute('site_url');
			var site_logo_img = configObj[0].getAttribute('site_logo_img');
			var site_email = configObj[0].getAttribute('site_email');
			var site_contact_no = configObj[0].getAttribute('site_contact_no');
			var site_copyright_text = configObj[0].getAttribute('site_copyright_text');
			var no_of_items_per_page = configObj[0].getAttribute('no_of_items_per_page'); 
			
			var categoryObj = xmlDoc.getElementsByTagName("categories");  
			var total_category_nums = categoryObj[0].getElementsByTagName("category").length;  
			 
			//var filenameVal = categoryObj[0].getElementsByTagName("category_item")[paras2].getElementsByTagName("filename")[0].childNodes[0].nodeValue;
			
			var cate_txt = ''; 
			var cntr;
			for (cntr = 0; cntr < total_category_nums; cntr++) {
				var category_id = categoryObj[0].getElementsByTagName("category")[cntr].getElementsByTagName("category_id")[0].childNodes[0].nodeValue;
				var category_name = categoryObj[0].getElementsByTagName("category")[cntr].getElementsByTagName("category_name")[0].childNodes[0].nodeValue;
				var category_slug = categoryObj[0].getElementsByTagName("category")[cntr].getElementsByTagName("category_slug")[0].childNodes[0].nodeValue;
				var category_summary = categoryObj[0].getElementsByTagName("category")[cntr].getElementsByTagName("category_summary")[0].childNodes[0].nodeValue;
				var category_thumbnail = categoryObj[0].getElementsByTagName("category")[cntr].getElementsByTagName("category_thumbnail")[0].childNodes[0].nodeValue; 
			
				cate_txt += '<li><a href="javascript:void(0);" onclick="operate_cateogory_items(\''+category_id+'\',\'0\');"><img src="'+category_thumbnail+'" alt="'+category_name+'" /></a></li>';
			}
       		
			setTimeout(() => { 
				var ret_cate_txt = '';
				if(cate_txt === ''){
					ret_cate_txt = '<strong> No record found! </strong>';
				}else{
					ret_cate_txt = '<div class="main-menu"><ul class="link-list">' + cate_txt + '</ul></div>';  
				}
		  		
				//$('.loading').hide();
				$("#fetch_categories_data").html( ret_cate_txt );	  
				
			},600);
		}); 
	}
	
	function operate_cateogory_items(sel_cateid, show_fav){
		jQuery(document).ready(function($){ 
			//$("#fetch_site_logo").css("display", "none");
			$("#fetch_site_logo").fadeOut("slow");
			$("#fetch_categories_data .main-menu").fadeOut("slow");
			$('.loading').show();
			//alert( sel_cateid );
			var random_number1 = Math.floor(Math.random() * 100);
			var xmlDoc = readXml("./xml/categories-gallery-items.xml?rm="+random_number1); 
			var CategoryObj = xmlDoc.getElementsByTagName("category_items"); 
			var CategoryItemObj = CategoryObj[0].getElementsByTagName("category_item");
			var total_gallery_items_nums = CategoryItemObj.length; 
			  
			var contrs1;  
			var saved_items_arrs = [];  
			var random_number2 = Math.floor(Math.random() * 100);
			readTextFile("./records.json?rm="+random_number2, function(resp_txts){
				var sel_rows = JSON.parse(resp_txts);    
				for (contrs1 = 0; contrs1 < sel_rows.length; contrs1++) {
					var db_item_id = sel_rows[contrs1]["item_id"];
					saved_items_arrs.push( db_item_id ); 
					/*var visitor_id =  datas[0]["visitor_id"];
					var category_id =  datas[0]["category_id"];*/  
				}   
			});
				
			setTimeout(() => {   
					
				var item_txt = '';
	
				var fav_nums = 0; 
				var cntrs;
				for (cntrs = 0; cntrs < total_gallery_items_nums; cntrs++) {
					var item_parent_id = CategoryItemObj[cntrs].getAttribute('parent_id');
					if(item_parent_id == sel_cateid){ 
					
						var item_id = CategoryItemObj[cntrs].getElementsByTagName("item_id")[0].childNodes[0].nodeValue;
						var item_name = CategoryItemObj[cntrs].getElementsByTagName("item_name")[0].childNodes[0].nodeValue;
						var item_slug = CategoryItemObj[cntrs].getElementsByTagName("item_slug")[0].childNodes[0].nodeValue;
						var item_summary = CategoryItemObj[cntrs].getElementsByTagName("item_summary")[0].childNodes[0].nodeValue;
						var item_thumbnail = CategoryItemObj[cntrs].getElementsByTagName("item_thumbnail")[0].childNodes[0].nodeValue;
						var item_type = CategoryItemObj[cntrs].getElementsByTagName("item_type")[0].childNodes[0].nodeValue;
						var item_video_url = ''; 
						if(item_type == "video"){
							item_video_url = CategoryItemObj[cntrs].getElementsByTagName("item_video_url")[0].childNodes[0].nodeValue;
						}
			
						var fav_cls_val = ''; 
						//alert( saved_items_arrs[0] + " <<====>> " + item_id); //item_id
						
						 if(saved_items_arrs.length){
							 if(saved_items_arrs.indexOf(item_id) !== -1){ 
								 fav_cls_val = 'favorite-cls'; 
								 fav_nums = fav_nums + 1;
							 
							 } 
						 } 
						 
						 if(show_fav == 1 && fav_cls_val == 'favorite-cls'){
						   
							if(item_video_url != ''){
								/* data-src-webm="https://nextapps.de/video/spotlight/big_buck_bunny.webm" data-src-ogg="https://nextapps.de/video/spotlight/big_buck_bunny.ogv"  
								<a class="spotlight" href="'+item_thumbnail+'" data-description="'+item_name+'">
								 */ 
								/// <img src="'+item_thumbnail+'" alt="'+item_name+'" class="img-thumbnail" />
			
								item_txt += '<div class="col-md-3 img-single position-relative">  <a class="spotlight" data-media="video" data-src-mp4="'+item_video_url+'" data-autoplay="false" data-poster="'+item_thumbnail+'"><img class="lazyload play-icon" src="./assets/images/play-button.svg" class="lazyload" /> <img src="'+item_thumbnail+'" alt="'+item_name+'" class="lazyload" /></a> <a href="javascript:void(0);" class="operate-fav-cls '+fav_cls_val+'" data-category-id="'+item_parent_id+'" data-item-id="'+item_id+'" id="fetch_item_anchor_id_'+item_id+'"><span class="heart-icon"><i class="fa fa-thumbs-up"></i></span></a> </div>';
							 
							}else{
							
								item_txt += '<div class="col-md-3 img-single position-relative"> <a class="spotlight" href="'+item_thumbnail+'" data-description="'+item_name+'"> <img src="'+item_thumbnail+'" alt="'+item_name+'" class="lazyload" /> </a> <a href="javascript:void(0);" class="operate-fav-cls '+fav_cls_val+'" data-category-id="'+item_parent_id+'" data-item-id="'+item_id+'" id="fetch_item_anchor_id_'+item_id+'"><span class="heart-icon"><i class="fa fa-thumbs-up"></i></span></a> </div>';
							}
						   
						 
						 }else if(show_fav == 0){
						 
							 if(item_video_url != ''){
							 
								item_txt += '<div class="col-md-3 img-single position-relative"><a class="spotlight" data-media="video" data-src-mp4="'+item_video_url+'" data-autoplay="false" data-poster="'+item_thumbnail+'"><img class="lazyload play-icon" src="./assets/images/play-button.svg" class="lazyload" />  <img src="'+item_thumbnail+'" alt="'+item_name+'" class="lazyload" /> </a> <a href="javascript:void(0);" class="operate-fav-cls '+fav_cls_val+'" data-category-id="'+item_parent_id+'" data-item-id="'+item_id+'" id="fetch_item_anchor_id_'+item_id+'"><span class="heart-icon"><i class="fa fa-thumbs-up"></i></span></a> </div>'; 
							
							 }else{
							 
								item_txt += '<div class="col-md-3 img-single position-relative"> <a class="spotlight" href="'+item_thumbnail+'" data-description="'+item_name+'"> <img src="'+item_thumbnail+'" alt="'+item_name+'" class="lazyload" /> </a> <a href="javascript:void(0);" class="operate-fav-cls '+fav_cls_val+'" data-category-id="'+item_parent_id+'" data-item-id="'+item_id+'" id="fetch_item_anchor_id_'+item_id+'"><span class="heart-icon"><i class="fa  fa-thumbs-up"></i></span></a> </div>'; 
							 
							 }
						 }
						 //onclick="operate_cateogory_items(\''+category_id+'\');"
					} 
				}
				
				var ret_items_txt = ''; 
				var sel_cate_thumbnail = './assets/images/interactive.svg'; /* default */
				var sel_cate_nav_cls;
				var ret_items_menu = '<div class="top-single"> <div class="d-flex"> <div class="menu-tab"> <div id="one"></div> <div id="two"></div> <div id="three"></div> </div>';
				
				var random_number3 = Math.floor(Math.random() * 100);  
				var xmlDoc3 = readXml("./xml/layout.xml?rm="+random_number3); 
				
				if(xmlDoc3.getElementsByTagName("categories").length){  
					var cateObj = xmlDoc3.getElementsByTagName("categories"); 
					var total_category_num = cateObj[0].getElementsByTagName("category").length; 
					 
					var cntrc; 
					ret_items_menu += '<div class="menu-hide"> <nav> <ul class="menu-nav-list">';
					for (cntrc = 0; cntrc < total_category_num; cntrc++) {
						var category_id = cateObj[0].getElementsByTagName("category")[cntrc].getElementsByTagName("category_id")[0].childNodes[0].nodeValue;
						var category_name = cateObj[0].getElementsByTagName("category")[cntrc].getElementsByTagName("category_name")[0].childNodes[0].nodeValue;
						var category_slug = cateObj[0].getElementsByTagName("category")[cntrc].getElementsByTagName("category_slug")[0].childNodes[0].nodeValue;
						var category_summary = cateObj[0].getElementsByTagName("category")[cntrc].getElementsByTagName("category_summary")[0].childNodes[0].nodeValue;
						var category_thumbnail = cateObj[0].getElementsByTagName("category")[cntrc].getElementsByTagName("category_thumbnail")[0].childNodes[0].nodeValue; 
						
						sel_cate_nav_cls = '';
						if(category_id == sel_cateid){
							sel_cate_thumbnail = category_thumbnail;
							sel_cate_nav_cls = 'active';
						}
						
						ret_items_menu += '<li class="' + sel_cate_nav_cls + '"><a href="javascript:void(0);" onclick="operate_cateogory_items(\''+category_id+'\',\'0\');"><img src="'+category_thumbnail+'" alt="'+category_name+'" /></a></li>'; 
					}
					
					ret_items_menu += '</ul> </nav> </div>'; 
				} 
				
				if(show_fav == 1){
				
					ret_items_menu += '</div> <a href="./index.html"><img class="category-logo" src="'+sel_cate_thumbnail+'" /></a> <a class="fav-link" href="javascript:void(0);" onclick="operate_cateogory_items(\''+sel_cateid+'\',\'0\');" id="fetch_favorite_txt">Clear Favorites</a> </div>'; 
				}else{
					ret_items_menu += '</div> <a href="./index.html"><img class="category-logo" src="'+sel_cate_thumbnail+'" /></a> <a class="fav-link" href="javascript:void(0);" onclick="operate_cateogory_items(\''+sel_cateid+'\',\'1\');" id="fetch_favorite_txt">Favorites ('+fav_nums+')</a> </div>'; 
				} 
				
				if(item_txt === ''){
					//ret_items_txt += '<div class="spotlight-group"> No record found! </div>';
					ret_items_txt += '<div class="container-custom"> '+ ret_items_menu +' <div class="w-100"> <div class="row gallery-row d-flex justify-content-center"> <div class="col-md-3 img-single position-relative"> No record found! </div> </div> </div> </div>';
				}else{
					ret_items_txt += '<div class="container-custom"> '+ ret_items_menu +' <div class="w-100"> <div class="row gallery-row d-flex justify-content-center"> '+ item_txt +' </div> </div> </div>';	 
					//ret_items_txt += '<div class="spotlight-group"> '+ item_txt +' </div>';
				}
				
				/*$("#fetch_categories_data").html(' <a href="javascript:void(0);" onclick="operate_main_cateogories();"> &laquo; Go Back </a> &nbsp; | &nbsp; <a href="javascript:void(0);" onclick="operate_cateogory_items(\''+sel_cateid+'\',\'1\');"> Show Favorite ('+fav_nums+')</a> <br> ' + ret_items_txt );*/
				
				$('.loading').hide();
				
				$("#fetch_categories_data").html( ret_items_txt ); 
				 
				$("a.operate-fav-cls").click(function() {
					var my_sel_category_id = $(this).attr("data-category-id");
					var my_sel_item_id = $(this).attr("data-item-id");
					
					var item_status = 0;
					if($(this).hasClass("favorite-cls")){ 
						item_status = 0;
						$(this).removeClass('favorite-cls');
					}else{
						item_status = 1;
						$(this).addClass('favorite-cls');
					}
				 
					var formData = new FormData();
					formData.append("visitor_id", '1');  
					formData.append("category_id", my_sel_category_id);  
					formData.append("item_id", my_sel_item_id);
					formData.append("item_status", item_status);  
								   
					$.ajax({
						cache: false,
						method: "POST",
						url: "script.php",
						contentType: false,
						processData: false,
						data: formData,
						beforeSend: function(){
							$('.loading').show();
						},
						success: function(resp_data){
							setTimeout(() => {
								$('.loading').hide();
							},500);
							
							resp_data = resp_data.trim();
							
							if($('#fetch_favorite_txt').html() == "Clear Favorites"){
								/* leaave it */
							}else{
								$('#fetch_favorite_txt').html("Favorites ("+resp_data+")");
							}  
							//$('#fetch_home_contents').html(resp_data);    
						}
					});  
				});
				
				$('.gallery-row').infiniteScroll({
					path: getPenPath,
					append: '.post',
					scrollThreshold: 500,
					status: '.page-load-status',
				});
				
				$('.top-single .menu-tab').click(function(){
					$('.menu-hide').toggleClass('show');
					$('.menu-tab').toggleClass('active');
				});
				
				$('.top-single a').click(function(){
					$('.menu-hide').removeClass('show');
					$('.menu-tab').removeClass('active');
				});
				 
			},800); 
			
		});
}	
	
	
	function readXml(xmlFile){  
		var xmlDoc; 
		if(typeof window.DOMParser != "undefined") {
			xmlhttp=new XMLHttpRequest();
			xmlhttp.open("GET",xmlFile,false);
			if (xmlhttp.overrideMimeType){
				xmlhttp.overrideMimeType('text/xml');
			}
			xmlhttp.send();
			xmlDoc=xmlhttp.responseXML;
		}
		else{
			xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
			xmlDoc.async="false";
			xmlDoc.load(xmlFile);
		}
		return xmlDoc; 
	}
	
	function readTextFile(file, callback) {
		var rawFile = new XMLHttpRequest();
		rawFile.overrideMimeType("application/json");
		rawFile.open("GET", file, true);
		rawFile.onreadystatechange = function() {
			if (rawFile.readyState === 4 && rawFile.status == "200") {
				callback(rawFile.responseText);
			}
		}
		rawFile.send(null);
	}
</script>

<div class="loading" style="display: none;">
	<div class="content"><img style="width: 100px;" src="./assets/images/loading.svg"/></div>
</div>
</body>
</html>