<!DOCTYPE html>
<html lang="en">
<head>
	<title>Craft Screen Development</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" />
	<link rel="stylesheet" href="./assets/css/style.css" /> 
</head>
<body>  
<h1>Welcome to Craft Screen Development</h1> 
<div class="wrapper">
	<div class="container">  
	
		<div class="row" id="fetch_categories_data">
			 Loading...
		</div>
		
		<!-- 
		<div class="row">
		  <div class="category-item">
			<a target="_blank" href="assets/images/image-1.jpg">
			  <img src="./assets/images/image-1.jpg" alt="Image 1" width="600" height="400">
			</a>
			<div class="desc">Add a description of the image here</div>
		  </div>
		</div>
		
		<div class="row">
		  <div class="category-item">
			<a target="_blank" href="assets/images/image-2.jpg">
			  <img src="./assets/images/image-2.jpg" alt="Image 2" width="600" height="400">
			</a>
			<div class="desc">Add a description of the image here</div>
		  </div>
		</div>
		
		<div class="row">
		  <div class="category-item">
			<a target="_blank" href="assets/images/image-3.jpg">
			  <img src="./assets/images/image-3.jpg" alt="Image 3" width="600" height="400">
			</a>
			<div class="desc">Add a description of the image here</div>
		  </div>
		</div>
		
		<div class="row">
		  <div class="category-item">
			<a target="_blank" href="assets/images/image-4.jpg">
			  <img src="./assets/images/image-4.jpg" alt="Image 4" width="600" height="400">
			</a>
			<div class="desc">Add a description of the image here</div>
		  </div>
		</div>
		
		<div class="clearfix"></div>  -->
	
	</div>
</div>

<script src="./assets/js/jquery-3.6.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script src="./assets/js/custom.js"></script>  
<script src="./assets/js/spotlight.bundle.js"></script>
<script>   
	operate_main_cateogories();
	
	function operate_main_cateogories(){
	
		jQuery(document).ready(function($){	 
	
			var random_number1 = Math.floor(Math.random() * 100);  
			var xmlDoc = readXml("./xml/layout.xml?rm="+random_number1); 
			var configObj = xmlDoc.getElementsByTagName("config"); 
			
			var site_name = configObj[0].getAttribute('site_name');
			var site_url = configObj[0].getAttribute('site_url');
			var site_logo_img = configObj[0].getAttribute('site_logo_img');
			var site_email = configObj[0].getAttribute('site_email');
			var site_contact_no = configObj[0].getAttribute('site_contact_no');
			var site_copyright_text = configObj[0].getAttribute('site_copyright_text');
			var no_of_items_per_page = configObj[0].getAttribute('no_of_items_per_page'); 
			
			var categoryObj = xmlDoc.getElementsByTagName("categories"); 
			var total_category_nums = categoryObj[0].getElementsByTagName("category").length; 
			 
			//var filenameVal = categoryObj[0].getElementsByTagName("category_item")[paras2].getElementsByTagName("filename")[0].childNodes[0].nodeValue;
			
			var cate_txt = ''; 
			var cntr;
			for (cntr = 0; cntr < total_category_nums; cntr++) {
				var category_id = categoryObj[0].getElementsByTagName("category")[cntr].getElementsByTagName("category_id")[0].childNodes[0].nodeValue;
				var category_name = categoryObj[0].getElementsByTagName("category")[cntr].getElementsByTagName("category_name")[0].childNodes[0].nodeValue;
				var category_slug = categoryObj[0].getElementsByTagName("category")[cntr].getElementsByTagName("category_slug")[0].childNodes[0].nodeValue;
				var category_summary = categoryObj[0].getElementsByTagName("category")[cntr].getElementsByTagName("category_summary")[0].childNodes[0].nodeValue;
				var category_thumbnail = categoryObj[0].getElementsByTagName("category")[cntr].getElementsByTagName("category_thumbnail")[0].childNodes[0].nodeValue; 
			
				cate_txt += '<div class="col-md-4 col-sm-12 item_thumb"> <a href="javascript:void(0);" onclick="operate_cateogory_items(\''+category_id+'\');"><img src="'+category_thumbnail+'" alt="'+category_name+'" class="img-thumbnail" /></a> <h2 class="heading"><a href="javascript:void(0);" onclick="operate_cateogory_items(\''+category_id+'\');"> '+category_name+' </a></h2> <div class="summary_txt">'+category_summary+'</div> </div>';
				
			}
					 
			$("#fetch_categories_data").html( cate_txt );	  
				  
			/*
			if(site_logo_img != ''){
				$("#fetch_site_logo_img").attr("src", site_logo_img ); 
			} */
										
			/*if(localStorage.getItem("my_tmp_file_name")){
				localStorage.removeItem("my_tmp_file_name");
			}*/
		}); 
	}
	
	function operate_cateogory_items(sel_cateid){
		jQuery(document).ready(function($){	 
			//lert( sel_cateid );
		
			var xmlDoc = readXml("./xml/categories-gallery-items.xml"); 
			var CategoryObj = xmlDoc.getElementsByTagName("category_items"); 
			var CategoryItemObj = CategoryObj[0].getElementsByTagName("category_item");
			var total_gallery_items_nums = CategoryItemObj.length; 
			  
			var contrs;  
			var saved_items_arrs = [];  
			var random_number = Math.floor(Math.random() * 100);
			readTextFile("./records.json?rm="+random_number, function(resp_txts){
				var sel_rows = JSON.parse(resp_txts);    
				for (contrs = 0; contrs < sel_rows.length; contrs++) {
					var db_item_id =  sel_rows[contrs]["item_id"];
					saved_items_arrs.push( db_item_id ); 
					/*var visitor_id =  datas[0]["visitor_id"];
					var category_id =  datas[0]["category_id"];*/  
				}   
			});
			
		setTimeout(() => {   
				
			var item_txt = '<div class="spotlight-group">'; 
			var cntrs;
			for (cntrs = 0; cntrs < total_gallery_items_nums; cntrs++) {
				var item_parent_id = CategoryItemObj[cntrs].getAttribute('parent_id');
				if(item_parent_id == sel_cateid){ 
				
					var item_id = CategoryItemObj[cntrs].getElementsByTagName("item_id")[0].childNodes[0].nodeValue;
					var item_name = CategoryItemObj[cntrs].getElementsByTagName("item_name")[0].childNodes[0].nodeValue;
					var item_slug = CategoryItemObj[cntrs].getElementsByTagName("item_slug")[0].childNodes[0].nodeValue;
					var item_summary = CategoryItemObj[cntrs].getElementsByTagName("item_summary")[0].childNodes[0].nodeValue;
					var item_thumbnail = CategoryItemObj[cntrs].getElementsByTagName("item_thumbnail")[0].childNodes[0].nodeValue;
					var fav_cls_val = ''; 
					//alert( saved_items_arrs[0] + " <<====>> " + item_id); //item_id
					 if(saved_items_arrs.indexOf(item_id) !== -1){ 
					 	 fav_cls_val = 'favorite-cls'; 
					 } 
					 // alert( fav_cls_val );
					 item_txt += '<div class="col-md-4 col-sm-12 item_thumb"> <a class="spotlight" href="'+item_thumbnail+'" data-description="'+item_name+'"> <img src="'+item_thumbnail+'" alt="'+item_name+'" class="img-thumbnail" /> </a> <a href="javascript:void(0);" class="operate-fav-cls '+fav_cls_val+'" data-category-id="'+item_parent_id+'" data-item-id="'+item_id+'" id="fetch_item_anchor_id_'+item_id+'">favorite</a> <h2 class="heading"> '+item_name+' </h2> <div class="summary_txt">'+item_summary+'</div> </div>'; 
					 
					 //onclick="operate_cateogory_items(\''+category_id+'\');"
				} 
			}
			
			item_txt += '</div>';
			
			$("#fetch_categories_data").html( ' <a href="javascript:void(0);" onclick="operate_main_cateogories();"> &laquo; Go Back </a> <br> ' + item_txt );
			
			 
			
			$(".operate-fav-cls").click(function() {
			 	var my_sel_category_id = $(this).attr("data-category-id");
				var my_sel_item_id = $(this).attr("data-item-id");
				
				var item_status = 0;
				if($(this).hasClass("favorite-cls")){ 
					item_status = 0;
					$(this).removeClass('favorite-cls');
				}else{
					item_status = 1;
					$(this).addClass('favorite-cls');
				}
			
				
				var formData = new FormData();
				formData.append("visitor_id", '1');  
				formData.append("category_id", my_sel_category_id);  
				formData.append("item_id", my_sel_item_id);
				formData.append("item_status", item_status);  
							   
				$.ajax({
					cache: false,
					method: "POST",
					url: "script.php",
					contentType: false,
					processData: false,
					data: formData,
					beforeSend: function(){
						//$('.loading').show();
					},
					success: function(resp_data){
						//$('.loading').hide();
						//$('#fetch_home_contents').html(resp_data); 
						if(resp_data == 1){
								alert("saved successfully!"); 
						}else{ 
							 	alert("error while saving the selected item!"); 
						} 
					}
				});  
			});
			 
		},600);
		
		/*
			var category_name = categoryObj[0].getElementsByTagName("category")[cntr].getElementsByTagName("category_name")[0].childNodes[0].nodeValue;
			var category_slug = categoryObj[0].getElementsByTagName("category")[cntr].getElementsByTagName("category_slug")[0].childNodes[0].nodeValue;
			var category_summary = categoryObj[0].getElementsByTagName("category")[cntr].getElementsByTagName("category_summary")[0].childNodes[0].nodeValue;
			var category_thumbnail = categoryObj[0].getElementsByTagName("category")[cntr].getElementsByTagName("category_thumbnail")[0].childNodes[0].nodeValue;  
		}
		$("#fetch_categories_data").html( cate_txt ); */
		
		});
	}	
	
	
	function readXml(xmlFile){  
		var xmlDoc; 
		if(typeof window.DOMParser != "undefined") {
			xmlhttp=new XMLHttpRequest();
			xmlhttp.open("GET",xmlFile,false);
			if (xmlhttp.overrideMimeType){
				xmlhttp.overrideMimeType('text/xml');
			}
			xmlhttp.send();
			xmlDoc=xmlhttp.responseXML;
		}
		else{
			xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
			xmlDoc.async="false";
			xmlDoc.load(xmlFile);
		}
		return xmlDoc; 
	}
	
	function readTextFile(file, callback) {
		var rawFile = new XMLHttpRequest();
		rawFile.overrideMimeType("application/json");
		rawFile.open("GET", file, true);
		rawFile.onreadystatechange = function() {
			if (rawFile.readyState === 4 && rawFile.status == "200") {
				callback(rawFile.responseText);
			}
		}
		rawFile.send(null);
	}
</script>
</body>
</html>